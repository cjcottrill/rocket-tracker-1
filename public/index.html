<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chris The Rocket Guy ‚Äì Florida Space Coast Launch Tracker</title>
    <meta name="description" content="Track upcoming rocket launches from Florida's Space Coast. Live countdown timers, launch details, and more.">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-card: #111827;
            --bg-card-hover: #1a2332;
            --accent: #f97316;
            --accent-glow: rgba(249, 115, 22, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #1e293b;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
        .site-header {
            text-align: center;
            padding: 2.5rem 1rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        .site-header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .site-header h1 .accent {
            color: var(--accent);
        }

        .site-header .tagline {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* ‚îÄ‚îÄ Container ‚îÄ‚îÄ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1.5rem 1rem 3rem;
        }

        /* ‚îÄ‚îÄ Loading State ‚îÄ‚îÄ */
        .loading {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ‚îÄ‚îÄ Error State ‚îÄ‚îÄ */
        .error-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--danger);
        }

        .error-state button {
            margin-top: 1rem;
            padding: 0.6rem 1.5rem;
            background: var(--accent);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 600;
        }

        /* ‚îÄ‚îÄ Empty State ‚îÄ‚îÄ */
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
        }

        .empty-state .rocket-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .empty-state h2 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .empty-state p {
            color: var(--text-secondary);
            font-size: 1rem;
            max-width: 400px;
            margin: 0 auto;
        }

        /* ‚îÄ‚îÄ Hero Launch ‚îÄ‚îÄ */
        .hero-launch {
            background: linear-gradient(135deg, var(--bg-card) 0%, #131c2e 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .hero-launch::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), #fb923c, var(--accent));
        }

        .hero-label {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--accent);
            margin-bottom: 1rem;
        }

        .hero-label .pulse-dot {
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 var(--accent-glow); }
            50% { opacity: 0.7; box-shadow: 0 0 0 8px transparent; }
        }

        .hero-mission-name {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 0.25rem;
        }

        .hero-provider {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 1.25rem;
        }

        .hero-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .hero-meta-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--text-secondary);
        }

        .hero-meta-item .label {
            color: var(--text-muted);
        }

        /* ‚îÄ‚îÄ Countdown ‚îÄ‚îÄ */
        .countdown-container {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }

        .countdown-unit {
            text-align: center;
            min-width: 60px;
        }

        .countdown-value {
            font-size: 2rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .countdown-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        .countdown-separator {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-muted);
            line-height: 1.2;
            align-self: flex-start;
        }

        .countdown-passed {
            text-align: center;
            color: var(--warning);
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* ‚îÄ‚îÄ Hero Status Badge ‚îÄ‚îÄ */
        .hero-status-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .status-go {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .status-tbd, .status-tbc {
            background: rgba(234, 179, 8, 0.15);
            color: var(--warning);
            border: 1px solid rgba(234, 179, 8, 0.3);
        }

        .status-hold {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .status-unknown {
            background: rgba(148, 163, 184, 0.15);
            color: var(--text-secondary);
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        /* ‚îÄ‚îÄ Section Header ‚îÄ‚îÄ */
        .section-header {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        /* ‚îÄ‚îÄ Launch List ‚îÄ‚îÄ */
        .launch-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .launch-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem;
            transition: background 0.2s, border-color 0.2s;
        }

        .launch-card:hover {
            background: var(--bg-card-hover);
            border-color: #2a3a4e;
        }

        .launch-card-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .launch-card-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .launch-card-provider {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 0.6rem;
        }

        .launch-card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .launch-card-meta .label {
            color: var(--text-muted);
        }

        .card-status-badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 5px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .launch-card-countdown {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-variant-numeric: tabular-nums;
        }

        .launch-card-countdown .countdown-inline-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
        .site-footer {
            text-align: center;
            padding: 2rem 1rem;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .site-footer a {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .site-footer a:hover {
            color: var(--accent);
        }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 600px) {
            .hero-launch {
                padding: 1.5rem;
            }

            .hero-mission-name {
                font-size: 1.3rem;
            }

            .countdown-container {
                gap: 0.6rem;
                padding: 1rem;
            }

            .countdown-value {
                font-size: 1.5rem;
            }

            .countdown-unit {
                min-width: 48px;
            }

            .countdown-separator {
                font-size: 1.5rem;
            }

            .hero-meta {
                flex-direction: column;
                gap: 0.5rem;
            }

            .launch-card-top {
                flex-direction: column;
                gap: 0.4rem;
            }
        }
    </style>
</head>
<body>

<header class="site-header">
    <h1>üöÄ <span class="accent">Chris</span> The Rocket Guy</h1>
    <p class="tagline">Florida Space Coast Launch Tracker</p>
</header>

<main class="container" id="app">
    <div class="loading" id="loading-state">
        <div class="loading-spinner"></div>
        <p>Fetching launch data‚Ä¶</p>
    </div>
</main>

<footer class="site-footer">
    <p>Data from <a href="https://thespacedevs.com/" target="_blank" rel="noopener">The Space Devs</a> &middot; Built by Chris The Rocket Guy</p>
</footer>

<script>
(function () {
    'use strict';

    const API_BASE = '/api/launches';
    const WINDOW_DAYS = 14;
    const app = document.getElementById('app');

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ

    function getWindowDates() {
        const now = new Date();
        const end = new Date(now.getTime() + WINDOW_DAYS * 24 * 60 * 60 * 1000);
        return {
            start: now.toISOString(),
            end: end.toISOString()
        };
    }

    function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString('en-US', {
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            year: 'numeric'
        });
    }

    function formatTime(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }

    function getStatusInfo(status) {
        if (!status) return { label: 'Unknown', cls: 'status-unknown' };
        const id = status.id;
        const abbrev = (status.abbrev || '').toUpperCase();
        if (id === 1 || abbrev === 'GO') return { label: 'GO', cls: 'status-go' };
        if (id === 2 || abbrev === 'TBD') return { label: 'TBD', cls: 'status-tbd' };
        if (id === 8 || abbrev === 'TBC') return { label: 'TBC', cls: 'status-tbc' };
        if (id === 5 || abbrev === 'HOLD') return { label: 'Hold', cls: 'status-hold' };
        return { label: abbrev || 'Unknown', cls: 'status-unknown' };
    }

    function getTimeDiff(dateStr) {
        const now = Date.now();
        const target = new Date(dateStr).getTime();
        const diff = target - now;
        if (diff <= 0) return null;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        return { days, hours, minutes, seconds, total: diff };
    }

    function getPadName(launch) {
        if (launch.pad && launch.pad.name) {
            return launch.pad.name;
        }
        return null;
    }

    function getMissionType(launch) {
        if (launch.mission && launch.mission.type) {
            return launch.mission.type;
        }
        return null;
    }

    function getProviderName(launch) {
        if (launch.launch_service_provider && launch.launch_service_provider.name) {
            return launch.launch_service_provider.name;
        }
        return 'Unknown Provider';
    }

    // ‚îÄ‚îÄ Fetch ‚îÄ‚îÄ

    async function fetchLaunches() {
        const { start, end } = getWindowDates();
        const params = new URLSearchParams({
            endpoint: 'launch/upcoming',
            window_start__gte: start,
            window_end__lte: end,
            limit: '25',
            ordering: 'net'
        });

        const response = await fetch(`${API_BASE}?${params.toString()}`);
        if (!response.ok) {
            throw new Error(`API error: ${response.status}`);
        }
        const data = await response.json();
        return data.results || [];
    }

    // ‚îÄ‚îÄ Render: Empty State ‚îÄ‚îÄ

    function renderEmpty() {
        app.innerHTML = `
            <div class="empty-state">
                <div class="rocket-icon">üöÄ</div>
                <h2>No Launches in the Next 2 Weeks</h2>
                <p>Check back soon ‚Äî the Space Coast never stays quiet for long.</p>
            </div>
        `;
    }

    // ‚îÄ‚îÄ Render: Error State ‚îÄ‚îÄ

    function renderError(msg) {
        app.innerHTML = `
            <div class="error-state">
                <p>‚ö†Ô∏è ${msg}</p>
                <button onclick="location.reload()">Try Again</button>
            </div>
        `;
    }

    // ‚îÄ‚îÄ Render: Hero ‚îÄ‚îÄ

    function renderHero(launch) {
        const status = getStatusInfo(launch.status);
        const provider = getProviderName(launch);
        const pad = getPadName(launch);
        const missionType = getMissionType(launch);
        const net = launch.net;

        let metaHTML = '';
        metaHTML += `<div class="hero-meta-item"><span class="label">Date:</span> ${formatDate(net)}</div>`;
        metaHTML += `<div class="hero-meta-item"><span class="label">Time:</span> ${formatTime(net)}</div>`;
        if (pad) {
            metaHTML += `<div class="hero-meta-item"><span class="label">Pad:</span> ${pad}</div>`;
        }
        if (missionType) {
            metaHTML += `<div class="hero-meta-item"><span class="label">Mission:</span> ${missionType}</div>`;
        }

        return `
            <div class="hero-launch" id="hero-launch">
                <div class="hero-label"><span class="pulse-dot"></span> Next Launch</div>
                <h2 class="hero-mission-name">${launch.name}</h2>
                <p class="hero-provider">${provider}</p>
                <span class="hero-status-badge card-status-badge ${status.cls}">${status.label}</span>
                <div class="hero-meta">${metaHTML}</div>
                <div class="countdown-container" id="hero-countdown" data-net="${net}">
                    <div class="countdown-unit"><div class="countdown-value" data-unit="days">--</div><div class="countdown-label">Days</div></div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit"><div class="countdown-value" data-unit="hours">--</div><div class="countdown-label">Hours</div></div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit"><div class="countdown-value" data-unit="minutes">--</div><div class="countdown-label">Min</div></div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-unit"><div class="countdown-value" data-unit="seconds">--</div><div class="countdown-label">Sec</div></div>
                </div>
            </div>
        `;
    }

    // ‚îÄ‚îÄ Render: Launch Card ‚îÄ‚îÄ

    function renderCard(launch, index) {
        const status = getStatusInfo(launch.status);
        const provider = getProviderName(launch);
        const pad = getPadName(launch);
        const net = launch.net;

        let metaHTML = '';
        metaHTML += `<span><span class="label">Date:</span> ${formatDate(net)}</span>`;
        metaHTML += `<span><span class="label">Time:</span> ${formatTime(net)}</span>`;
        if (pad) {
            metaHTML += `<span><span class="label">Pad:</span> ${pad}</span>`;
        }

        return `
            <div class="launch-card">
                <div class="launch-card-top">
                    <div class="launch-card-name">${launch.name}</div>
                    <span class="card-status-badge ${status.cls}">${status.label}</span>
                </div>
                <div class="launch-card-provider">${provider}</div>
                <div class="launch-card-meta">${metaHTML}</div>
                <div class="launch-card-countdown" id="card-countdown-${index}" data-net="${net}"></div>
            </div>
        `;
    }

    // ‚îÄ‚îÄ Render: Full Page ‚îÄ‚îÄ

    function renderLaunches(launches) {
        if (launches.length === 0) {
            renderEmpty();
            return;
        }

        const hero = launches[0];
        const rest = launches.slice(1);

        let html = renderHero(hero);

        if (rest.length > 0) {
            html += `<div class="section-header">Also Coming Up</div>`;
            html += `<div class="launch-list">`;
            rest.forEach((launch, i) => {
                html += renderCard(launch, i);
            });
            html += `</div>`;
        }

        app.innerHTML = html;
        startCountdowns();
    }

    // ‚îÄ‚îÄ Countdowns ‚îÄ‚îÄ

    let countdownInterval = null;

    function updateCountdowns() {
        // Hero countdown
        const heroEl = document.getElementById('hero-countdown');
        if (heroEl) {
            const net = heroEl.getAttribute('data-net');
            const diff = getTimeDiff(net);
            if (diff) {
                heroEl.querySelector('[data-unit="days"]').textContent = String(diff.days).padStart(2, '0');
                heroEl.querySelector('[data-unit="hours"]').textContent = String(diff.hours).padStart(2, '0');
                heroEl.querySelector('[data-unit="minutes"]').textContent = String(diff.minutes).padStart(2, '0');
                heroEl.querySelector('[data-unit="seconds"]').textContent = String(diff.seconds).padStart(2, '0');
            } else {
                heroEl.innerHTML = '<div class="countdown-passed">T-0 has passed ‚Äî waiting for status update</div>';
            }
        }

        // Card countdowns
        document.querySelectorAll('[id^="card-countdown-"]').forEach(el => {
            const net = el.getAttribute('data-net');
            const diff = getTimeDiff(net);
            if (diff) {
                let parts = [];
                if (diff.days > 0) parts.push(`<span class="countdown-inline-value">${diff.days}</span>d`);
                parts.push(`<span class="countdown-inline-value">${String(diff.hours).padStart(2, '0')}</span>h`);
                parts.push(`<span class="countdown-inline-value">${String(diff.minutes).padStart(2, '0')}</span>m`);
                parts.push(`<span class="countdown-inline-value">${String(diff.seconds).padStart(2, '0')}</span>s`);
                el.innerHTML = `T-minus ${parts.join(' ')}`;
            } else {
                el.innerHTML = '<span style="color: var(--warning);">T-0 has passed</span>';
            }
        });
    }

    function startCountdowns() {
        if (countdownInterval) clearInterval(countdownInterval);
        updateCountdowns();
        countdownInterval = setInterval(updateCountdowns, 1000);
    }

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ

    async function init() {
        try {
            const launches = await fetchLaunches();
            renderLaunches(launches);
        } catch (err) {
            console.error('Failed to load launches:', err);
            renderError('Unable to load launch data. Please try again.');
        }
    }

    init();
})();
</script>

</body>
</html>
