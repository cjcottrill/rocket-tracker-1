<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chris The Rocket Guy - Space Coast Launch Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, sans-serif;
            background: #0a0e17;
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 2rem 1rem 1rem;
            background: linear-gradient(180deg, #0d1525 0%, #0a0e17 100%);
        }

        .header h1 {
            font-size: 1.8rem;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .header .subtitle {
            color: #7a8ba8;
            font-size: 0.95rem;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* --- NEXT LAUNCH HERO --- */
        .hero {
            background: linear-gradient(135deg, #111927 0%, #0d1525 100%);
            border: 1px solid #1e2a3a;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .hero-label {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 2px;
            color: #7a8ba8;
            margin-bottom: 0.75rem;
        }

        .hero-mission {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .hero-provider {
            color: #7a8ba8;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .hero-pad {
            color: #556b8a;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .hero-time {
            color: #c0c8d8;
            font-size: 1rem;
            margin-bottom: 0.15rem;
        }

        .hero-time-local {
            color: #7a8ba8;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .hero-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1.25rem;
        }

        .status-go {
            background: #0b3d2e;
            color: #34d399;
            border: 1px solid #166534;
        }

        .status-tbd {
            background: #2d2306;
            color: #fbbf24;
            border: 1px solid #854d0e;
        }

        .status-tbc {
            background: #1e2a3a;
            color: #60a5fa;
            border: 1px solid #1e40af;
        }

        .status-hold {
            background: #3b1118;
            color: #f87171;
            border: 1px solid #991b1b;
        }

        .countdown {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .countdown-unit {
            background: #0a0e17;
            border: 1px solid #1e2a3a;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            min-width: 70px;
        }

        .countdown-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: #ffffff;
            font-variant-numeric: tabular-nums;
        }

        .countdown-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #556b8a;
            margin-top: 0.2rem;
        }

        .countdown-elapsed {
            color: #7a8ba8;
            font-size: 1rem;
            margin-top: 1rem;
        }

        /* --- UPCOMING LIST --- */
        .upcoming-header {
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #556b8a;
            margin-bottom: 1rem;
        }

        .launch-card {
            background: #111927;
            border: 1px solid #1e2a3a;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }

        .launch-info {
            flex: 1;
        }

        .launch-mission {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.2rem;
        }

        .launch-provider {
            font-size: 0.85rem;
            color: #7a8ba8;
            margin-bottom: 0.15rem;
        }

        .launch-pad {
            font-size: 0.8rem;
            color: #556b8a;
        }

        .launch-right {
            text-align: right;
            flex-shrink: 0;
        }

        .launch-date {
            font-size: 0.9rem;
            color: #c0c8d8;
            margin-bottom: 0.15rem;
        }

        .launch-date-local {
            font-size: 0.8rem;
            color: #7a8ba8;
            margin-bottom: 0.35rem;
        }

        .launch-status {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- STATES --- */
        .loading, .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #556b8a;
        }

        .loading {
            font-size: 1rem;
        }

        .empty-state {
            font-size: 1.1rem;
            font-style: italic;
        }

        .error-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #f87171;
        }

        .description {
            font-size: 0.85rem;
            color: #7a8ba8;
            margin-top: 0.5rem;
            line-height: 1.5;
        }

        .hero .description {
            margin-top: 1rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 480px) {
            .hero {
                padding: 1.5rem 1rem;
            }

            .countdown {
                gap: 0.5rem;
            }

            .countdown-unit {
                min-width: 60px;
                padding: 0.5rem 0.75rem;
            }

            .countdown-value {
                font-size: 1.3rem;
            }

            .launch-card {
                flex-direction: column;
                gap: 0.5rem;
            }

            .launch-right {
                text-align: left;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>ðŸš€ Chris The Rocket Guy</h1>
    <p class="subtitle">Florida Space Coast Launch Tracker</p>
</div>

<div class="container" id="app">
    <div class="loading">Loading launch data...</div>
</div>

<script>
    // ============================================================
    //  TIMEZONE HELPERS
    // ============================================================
    const FLORIDA_TZ = 'America/New_York';

    function userIsEastern() {
        try {
            const userTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
            // Compare actual offset right now (handles DST correctly)
            const now = new Date();
            const floridaOffset = getOffsetMinutes(now, FLORIDA_TZ);
            const localOffset = getOffsetMinutes(now, userTZ);
            return floridaOffset === localOffset;
        } catch (e) {
            return false;
        }
    }

    function getOffsetMinutes(date, tz) {
        const str = date.toLocaleString('en-US', { timeZone: tz });
        const localDate = new Date(str);
        return localDate.getTime();
    }

    function formatFloridaTime(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleString('en-US', {
            timeZone: FLORIDA_TZ,
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }

    function formatLocalTime(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleString('en-US', {
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }

    function formatFloridaDateShort(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleString('en-US', {
            timeZone: FLORIDA_TZ,
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }

    function formatLocalDateShort(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleString('en-US', {
            month: 'short',
            day: 'numeric',
            hour: 'numeric',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    }

    const showLocal = !userIsEastern();

    // ============================================================
    //  STATUS HELPERS
    // ============================================================
    function getStatusClass(abbrev) {
        switch (abbrev) {
            case 'Go': return 'status-go';
            case 'TBD': return 'status-tbd';
            case 'TBC': return 'status-tbc';
            default: return 'status-hold';
        }
    }

    function getStatusLabel(abbrev) {
        switch (abbrev) {
            case 'Go': return 'GO';
            case 'TBD': return 'TBD';
            case 'TBC': return 'To Be Confirmed';
            default: return abbrev || 'Unknown';
        }
    }

    // ============================================================
    //  FETCH
    // ============================================================
    async function fetchLaunches() {
        const now = new Date();
        const future = new Date(now.getTime() + 14 * 24 * 60 * 60 * 1000);
        const gte = now.toISOString().split('T')[0];
        const lte = future.toISOString().split('T')[0];

        const url = `/api/launches?endpoint=launch/upcoming&window_start__gte=${gte}&window_end__lte=${lte}&limit=20&mode=detailed`;
        const resp = await fetch(url);
        if (!resp.ok) throw new Error(`API error ${resp.status}`);
        const data = await resp.json();
        return data.results || [];
    }

    // ============================================================
    //  RENDER
    // ============================================================
    function render(launches) {
        const app = document.getElementById('app');

        if (!launches.length) {
            app.innerHTML = `<div class="empty-state">Check back soon â€” the Space Coast never stays quiet for long. ðŸŒ´</div>`;
            return;
        }

        const hero = launches[0];
        const rest = launches.slice(1);

        let html = buildHero(hero);

        if (rest.length) {
            html += `<div class="upcoming-header">Also Coming Up</div>`;
            rest.forEach(l => { html += buildCard(l); });
        }

        app.innerHTML = html;
        startCountdown(hero);
    }

    function buildHero(l) {
        const name = l.name || 'Unknown Mission';
        const provider = l.launch_service_provider?.name || '';
        const pad = l.pad?.name || '';
        const statusAbbrev = l.status?.abbrev || 'TBD';
        const statusClass = getStatusClass(statusAbbrev);
        const statusLabel = getStatusLabel(statusAbbrev);
        const desc = l.mission?.description || '';
        const floridaTime = formatFloridaTime(l.net);
        const localTime = showLocal ? formatLocalTime(l.net) : '';

        return `
        <div class="hero">
            <div class="hero-label">Next Launch</div>
            <div class="hero-mission">${name}</div>
            ${provider ? `<div class="hero-provider">${provider}</div>` : ''}
            ${pad ? `<div class="hero-pad">${pad}</div>` : ''}
            <div class="hero-time">${floridaTime}</div>
            ${localTime ? `<div class="hero-time-local">Your time: ${localTime}</div>` : ''}
            <div><span class="hero-status ${statusClass}">${statusLabel}</span></div>
            <div class="countdown" id="countdown">
                <div class="countdown-unit"><div class="countdown-value" id="cd-days">--</div><div class="countdown-label">Days</div></div>
                <div class="countdown-unit"><div class="countdown-value" id="cd-hrs">--</div><div class="countdown-label">Hours</div></div>
                <div class="countdown-unit"><div class="countdown-value" id="cd-min">--</div><div class="countdown-label">Min</div></div>
                <div class="countdown-unit"><div class="countdown-value" id="cd-sec">--</div><div class="countdown-label">Sec</div></div>
            </div>
            ${desc ? `<div class="description">${desc}</div>` : ''}
        </div>`;
    }

    function buildCard(l) {
        const name = l.name || 'Unknown Mission';
        const provider = l.launch_service_provider?.name || '';
        const pad = l.pad?.name || '';
        const statusAbbrev = l.status?.abbrev || 'TBD';
        const statusClass = getStatusClass(statusAbbrev);
        const statusLabel = getStatusLabel(statusAbbrev);
        const floridaDate = formatFloridaDateShort(l.net);
        const localDate = showLocal ? formatLocalDateShort(l.net) : '';

        return `
        <div class="launch-card">
            <div class="launch-info">
                <div class="launch-mission">${name}</div>
                ${provider ? `<div class="launch-provider">${provider}</div>` : ''}
                ${pad ? `<div class="launch-pad">${pad}</div>` : ''}
            </div>
            <div class="launch-right">
                <div class="launch-date">${floridaDate}</div>
                ${localDate ? `<div class="launch-date-local">Your time: ${localDate}</div>` : ''}
                <span class="launch-status ${statusClass}">${statusLabel}</span>
            </div>
        </div>`;
    }

    // ============================================================
    //  COUNTDOWN
    // ============================================================
    function startCountdown(launch) {
        const target = new Date(launch.net).getTime();

        function tick() {
            const now = Date.now();
            const diff = target - now;

            if (diff <= 0) {
                const elapsed = Math.abs(diff);
                const elapsedMin = Math.floor(elapsed / 60000);
                const el = document.getElementById('countdown');
                if (el) {
                    if (elapsedMin < 60) {
                        el.innerHTML = `<div class="countdown-elapsed">T-0 was ${elapsedMin} minute${elapsedMin !== 1 ? 's' : ''} ago</div>`;
                    } else {
                        el.innerHTML = `<div class="countdown-elapsed">Launched!</div>`;
                    }
                }
                return;
            }

            const days = Math.floor(diff / 86400000);
            const hrs = Math.floor((diff % 86400000) / 3600000);
            const min = Math.floor((diff % 3600000) / 60000);
            const sec = Math.floor((diff % 60000) / 1000);

            const dEl = document.getElementById('cd-days');
            const hEl = document.getElementById('cd-hrs');
            const mEl = document.getElementById('cd-min');
            const sEl = document.getElementById('cd-sec');
            if (dEl) dEl.textContent = String(days).padStart(2, '0');
            if (hEl) hEl.textContent = String(hrs).padStart(2, '0');
            if (mEl) mEl.textContent = String(min).padStart(2, '0');
            if (sEl) sEl.textContent = String(sec).padStart(2, '0');

            requestAnimationFrame(tick);
        }

        tick();
    }

    // ============================================================
    //  INIT
    // ============================================================
    fetchLaunches()
        .then(render)
        .catch(err => {
            console.error(err);
            document.getElementById('app').innerHTML = `<div class="error-state">Unable to load launch data. Please try again later.</div>`;
        });
</script>

</body>
</html>
